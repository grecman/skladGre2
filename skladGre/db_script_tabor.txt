-- ocekava se existence databaze "greca" s nejakym superuserem "greca"

CREATE ROLE skladnik LOGIN ENCRYPTED PASSWORD 'md599f11e5dc38f3ca02e47b5cb07bdae15'
   VALID UNTIL 'infinity';


CREATE DATABASE greca;

-- vse ostatni jiz spouste po DB greca !!!

CREATE SCHEMA tabor;



CREATE TABLE tabor.POTRAVINA (
    id integer NOT NULL,
    jmeno text NOT NULL,
    merna_jednotka real
);
 

CREATE TABLE tabor.SKLAD (
    id integer NOT NULL,
    cena real NOT NULL,
    datum_prijmu date,
    datum_vydeje date,
    uctenka integer,
    id_potravina integer,
    id_den integer
);

CREATE TABLE tabor.DEN (
    id integer NOT NULL,
    den date NOT NULL,
    norma integer
);

CREATE TABLE tabor.USER (
    id integer NOT NULL,
    nick text NOT NULL,
    password text NOT NULL,
    role text,
    pocet_prihlaseni integer,
    posledni_prihlaseni timestamp without time zone
);


ALTER TABLE ONLY tabor.POTRAVINA
    ADD CONSTRAINT "Potravina_pkey" PRIMARY KEY (id);

ALTER TABLE ONLY tabor.SKLAD
    ADD CONSTRAINT "Sklad_pkey" PRIMARY KEY (id);
 
ALTER TABLE ONLY tabor.DEN
    ADD CONSTRAINT "TaborovyDen_pkey" PRIMARY KEY (id);
    
ALTER TABLE ONLY tabor.USER
    ADD CONSTRAINT "Users_pkey" PRIMARY KEY (id);


ALTER TABLE ONLY tabor.SKLAD
    ADD CONSTRAINT fk_4xu9wxeiuafns3ealhss8ue1p FOREIGN KEY (id_potravina) REFERENCES tabor.POTRAVINA(id);

ALTER TABLE ONLY tabor.SKLAD
    ADD CONSTRAINT fk_m2y220gw673dd09p4beo0aija FOREIGN KEY (id_den) REFERENCES tabor.DEN(id);
    
    
CREATE SEQUENCE tabor.hibernate_sequence
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
    
GRANT USAGE ON SCHEMA tabor TO skladnik;    

GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE tabor.POTRAVINA TO skladnik;

GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE tabor.SKLAD TO skladnik;

GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE tabor.DEN TO skladnik;

GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE tabor.USER TO skladnik;

GRANT ALL ON TABLE tabor.hibernate_sequence TO skladnik;

